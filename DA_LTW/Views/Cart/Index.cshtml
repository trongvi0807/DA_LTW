@model List<DA_LTW.Models.cart_items>
@{
    ViewBag.Title = "Giỏ hàng của bạn";
    Layout = "~/Views/Shared/_LayoutCustomer.cshtml";
}

<style>
    /* --- CSS CƠ BẢN (Đã có từ trước) --- */
    .cart-container {
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        padding: 40px;
        margin-top: 30px;
        margin-bottom: 50px;
        display: flex !important;
        flex-direction: column !important;
        align-items: center;
    }

    .cart-title {
        width: 100%;
        text-align: center;
        color: #2c3e50;
        font-weight: 800;
        text-transform: uppercase;
        margin-bottom: 30px;
        border-bottom: 2px solid #eaeaea;
        padding-bottom: 15px;
    }

    /* --- CSS BẢNG SẢN PHẨM MỚI --- */
    .cart-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 15px; /* Tạo khoảng cách giữa các hàng */
    }

        .cart-table thead th {
            background-color: transparent;
            color: #7f8c8d;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
            border: none;
            padding-bottom: 10px;
        }

        .cart-table tbody tr {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); /* Đổ bóng từng dòng */
            transition: transform 0.2s;
        }

            .cart-table tbody tr:hover {
                transform: scale(1.01); /* Hiệu ứng nổi lên khi di chuột */
            }

        .cart-table td {
            vertical-align: middle;
            padding: 15px;
            border-top: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
        }

            .cart-table td:first-child {
                border-left: 1px solid #f0f0f0;
                border-top-left-radius: 8px;
                border-bottom-left-radius: 8px;
            }

            .cart-table td:last-child {
                border-right: 1px solid #f0f0f0;
                border-top-right-radius: 8px;
                border-bottom-right-radius: 8px;
            }

    /* 🖼️ CSS ẢNH SẢN PHẨM */
    .product-img-box {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #eee;
        display: flex;
        align-items: center;
        justify-content: center;
    }

        .product-img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Đảm bảo ảnh không bị méo */
        }

    .product-name {
        font-size: 16px;
        font-weight: 700;
        color: #2c3e50;
        display: block;
        margin-bottom: 5px;
    }

    .product-cat {
        font-size: 13px;
        color: #95a5a6;
    }

    /* ➕➖ CSS NÚT TĂNG GIẢM SỐ LƯỢNG */
    .quantity-box {
        display: inline-flex;
        align-items: center;
        border: 1px solid #ddd;
        border-radius: 25px; /* Bo tròn cụm nút */
        overflow: hidden;
    }

    .btn-qty {
        background-color: #f8f9fa;
        border: none;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #333;
        font-weight: bold;
        text-decoration: none; /* Xóa gạch chân thẻ a */
        transition: 0.2s;
    }

        .btn-qty:hover {
            background-color: #e2e6ea;
            color: #000;
        }

    .qty-input {
        width: 40px;
        text-align: center;
        border: none;
        font-weight: 600;
        color: #333;
        background: white;
    }

        /* Ẩn nút tăng giảm mặc định của input number */
        .qty-input::-webkit-outer-spin-button,
        .qty-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

    /* Tổng tiền và Footer */
    .total-price {
        font-size: 22px;
        font-weight: 800;
        color: #e74c3c;
    }

    .cart-actions {
        width: 100%;
        margin-top: 30px;
    }

    .btn-checkout {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px 30px;
        font-size: 16px;
        box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
    }

    .btn-delete:hover {
        color: #e74c3c !important;
        background: none !important;
    }
</style>

<div class="container cart-container">
    <h2 class="cart-title">🛒 Giỏ hàng của bạn</h2>

    @if (Model == null || !Model.Any())
    {
        <div class="empty-cart-box text-center" style="width:100%; padding: 50px;">
            <img src="https://cdn-icons-png.flaticon.com/512/11329/11329060.png" alt="Empty Cart" style="width: 100px; opacity: 0.6; margin-bottom: 20px;">
            <h4 class="text-muted">Chưa có sản phẩm nào trong giỏ</h4>
            <a href="@Url.Action("Index", "HomeCustomer")" class="btn btn-primary mt-3 rounded-pill px-4">
                Mua sắm ngay
            </a>
        </div>
    }
    else
    {
        <div class="table-responsive" style="width:100%">
            <table class="table cart-table">
                <thead>
                    <tr>
                        <th style="width: 10%;">Ảnh</th>
                        <th style="width: 35%;">Thông tin sản phẩm</th>
                        <th style="width: 15%; text-align: center;">Đơn giá</th>
                        <th style="width: 15%; text-align: center;">Số lượng</th>
                        <th style="width: 15%; text-align: center;">Thành tiền</th>
                        <th style="width: 10%; text-align: center;"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <div class="product-img-box">
                                    <img src="@(string.IsNullOrEmpty(item.product.thumbnail_url) ? "https://via.placeholder.com/80" : item.product.thumbnail_url)"
                                         alt="@item.product_name" />
                                </div>
                            </td>

                            <td>
                                <span class="product-name">@item.product_name</span>
                                <span class="product-cat">Mã SP: #@item.product_id</span>
                            </td>

                            <td class="text-center fw-bold">
                                @string.Format("{0:N0} ₫", item.sale_price)
                            </td>

                            <td class="text-center">
                                <div class="quantity-box">
                                    <a href="@Url.Action("UpdateQuantity", "Cart", new { id = item.product_id, quantity = item.quantity - 1 })"
                                       class="btn-qty">-</a>

                                    <input type="number" value="@item.quantity" class="qty-input" readonly />

                                    <a href="@Url.Action("UpdateQuantity", "Cart", new { id = item.product_id, quantity = item.quantity + 1 })"
                                       class="btn-qty">+</a>
                                </div>
                            </td>

                            <td class="text-center">
                                <span style="color: #2980b9; font-weight: 700;">
                                    @string.Format("{0:N0} ₫", item.sale_price * item.quantity)
                                </span>
                            </td>

                            <td class="text-center">
                                @Html.ActionLink("Xóa", "Remove", "Cart", new { id = item.product_id },
                                    new { @class = "text-muted", style = "text-decoration:none; font-size:20px;", title = "Xóa sản phẩm", onclick = "return confirm('Xóa sản phẩm này?');" })
                                <i class="fa fa-trash-o"></i>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="row mt-4 align-items-center" style="width:100%">
            <div class="col-md-6">
                <a href="@Url.Action("Index", "HomeCustomer")" class="text-decoration-none text-secondary">
                    <i class="fa fa-long-arrow-left"></i> Tiếp tục mua sắm
                </a>
            </div>
            <div class="col-md-6 text-end">
                <div class="d-flex justify-content-end align-items-center mb-3">
                    <span class="me-3 text-muted">Tổng thanh toán:</span>
                    <span class="total-price">
                        @string.Format("{0:N0} ₫", Model.Sum(i => i.sale_price * i.quantity))
                    </span>
                </div>
                <a href="@Url.Action("Index", "Checkout")" class="btn btn-primary btn-checkout rounded-pill text-white">
                    Thanh toán ngay <i class="fa fa-check"></i>
                </a>
            </div>
        </div>
    }
</div>